# User Management:
 
Commands for user management

Note that, to perform sudo actions for currently 

## 1. User Listing:

The `/etc/passwd` file stores essential information about user accounts in the system. It is a plain text file that can be read by any user but is writable only by the root user.

```sh
> cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin

# username:x:UID:GID:full_name:home_directory:shell
```

- **username:** The login name of the user, muse be unique.

- **x:** Represents the encrypted password (or x if the password is stored in `/etc/shadow` for security).

- **uid:** User id, `0 for root user` , `1-999 for system and service account`, `1000+ for regular user account`.

- **GID:** User group id, stored in `/etc/group`

- **home_directory:** Path to user home directory. ``Example: home/<user>``

- **shell:** User's default shell. ``Example: /bin/bash, /sbin/nologin (for nologin)``

```sh
# all users
cat /etc/passwd | cut -d: -f1

# users with nologin
cat /etc/passwd | grep nologin | cut -d: -f1
```


## 2. Creating / Add a new user:

**adduser**

> Guided way of creating a new user: ``sudo adduser``. See ``man adduser`` for options.

While adding new user with ``adduser`` command, configuration at ``/etc/adduser.conf`` is used. 
``/etc/adduser.conf`` specifies default user shell, home directory, ...

```bash
# /etc/adduser.conf: `adduser' configuration.
# See adduser(8) and adduser.conf(5) for full documentation.

# A commented out setting indicates that this is the default in the
# code. If you need to change those settings, remove the comment and
# make your intended change.

# STDERRMSGLEVEL, STDOUTMSGLEVEL, and LOGMSGLEVEL set the minimum
# priority for messages logged to syslog/journal and the console,
# respectively.
# Values are trace, debug, info, warn, err, and fatal.
# Messages with the set priority or higher get logged to the
# respective medium.
#STDERRMSGLEVEL=warn
#STDOUTMSGLEVEL=info
#SYSLOGLEVEL=info

# The login shell to be used for all new users.
# Default: DSHELL=/bin/bash
#DSHELL=/bin/bash

# The directory in which new home directories should  be  created.
# Default: DHOME=/home
# DHOME=/home

# The directory from which skeletal user configuration files
# will be copied.
# Default: SKEL=/etc/skel
#SKEL=/etc/skel

# Specify inclusive ranges of UIDs and GIDs from which UIDs and GIDs
# for system users, system groups, non-system users and non-system groups
# can be dynamically allocated.
# Default: FIRST_SYSTEM_UID=100, LAST_SYSTEM_UID=999
#FIRST_SYSTEM_UID=100
#LAST_SYSTEM_UID=999

# Default: FIRST_SYSTEM_GID=100, LAST_SYSTEM_GID=999
#FIRST_SYSTEM_GID=100
#LAST_SYSTEM_GID=999

# Default: FIRST_UID=1000, LAST_UID=59999
#FIRST_UID=1000
#LAST_UID=59999

# Default: FIRST_GID=1000, LAST_GID=59999
#FIRST_GID=1000
#LAST_GID=59999

# Specify a file or a directory containing UID and GID pool.
#UID_POOL=/etc/adduser-pool.conf
#UID_POOL=/etc/adduser-pool.d/
#GID_POOL=/etc/adduser-pool.conf
#GID_POOL=/etc/adduser-pool.d/

# Specify whether each created non-system user will be
# given their own group to use.
# Default: USERGROUPS=yes
#USERGROUPS=yes

# Defines the groupname or GID of the group all newly-created
# non-system users are placed into.
# It is a configuration error to define both variables
# even if the values are consistent.
# Default: USERS_GID=undefined, USERS_GROUP=users
#USERS_GID=100
#USERS_GROUP=users

# The permissions mode for home directories of non-system users.
# Default: DIR_MODE=0750
#DIR_MODE=0750
```

Other way is to add user with: ``useradd``

```sh
sudo useradd -u <user_id> -g <group_id> -d <user_home_directory> -s <user_shell> -m <username>
```

Use above flags:

- `-u` to provide `user_id`

- `-g` to provide  `group_id`, check group id at: `/etc/group`

- `-d` to provide user home directory.

- `-s` to specify shell, shell options: any one of ``cat /etc/shells``

- `-m` is to create a home directory for user if it doesnt exists. By default its not created. Only, entry in /etc/passed is created.

User's current:

- **shell:** ``echo $SHELL``
- **home:** ``echo $HOME``
- **group:** ``group``



**Example:**

```bash
# create only user
sudo useradd kk
# kk:x:1002:1003::/home/kk:/bin/sh
```

> Note that no home directory is created, we have to create manually.

# Remove a user:

To remove a user: ``sudo userdel <option> <username>``

**options:**
- ``-r`` Remove user's home directory.


```bash
# delete user
sudo userdel <user>

# search for user
cat /etc/passwd | grep <username>
```

Other way is to delete with: ``sudo deluser <username>``, configuration located at: ``/etc/deluser.conf``

> /etc/deluser.conf

```bash
# /etc/deluser.conf: `deluser' configuration.
# See deluser(8) and deluser.conf(5) for full documentation.

# A commented out setting indicates that this is the default in the
# code. If you need to change those settings, remove the comment and
# make your intended change.

# Remove home directory and mail spool when user is removed
# Default: REMOVE_HOME = 0
#REMOVE_HOME = 0

# Remove all files on the system owned by the user to be removed
# Default: REMOVE_ALL_FILES = 0
#REMOVE_ALL_FILES = 0

# Backup files before removing them. This options has only an effect if
# REMOVE_HOME or REMOVE_ALL_FILES is set.
# Default: BACKUP = 0
#BACKUP = 0

# Target directory for the backup file
# Default: BACKUP_TO = "."
#BACKUP_TO = "."

# Select compression (from tar --auto-compress) for backups
# Default: BACKUP_SUFFIX = .gz
#BACKUP_SUFFIX = .gz

# Space-Separated list of regular expressions. Do not delete files
# matching any of these.
# Default: NO_DEL_PATHS="^/bin\$ ^/boot\$ ^/dev\$ ^/etc\$ ^/initrd ^/lib ^/lost+found\$ ^/media\$ ^/mnt\$ ^/opt\$ ^/proc\$ ^/root\$ ^/run\$ ^/sbin\$ ^/srv\$ ^/sys\$ ^/tmp\$ ^/usr\$ ^/var\$ ^/vmlinu"
#NO_DEL_PATHS="^/bin\$ ^/boot\$ ^/dev\$ ^/etc\$ ^/initrd ^/lib ^/lost+found\$ ^/media\$ ^/mnt\$ ^/opt\$ ^/proc\$ ^/root\$ ^/run\$ ^/sbin\$ ^/srv\$ ^/sys\$ ^/tmp\$ ^/usr\$ ^/var\$ ^/vmlinu"

# Only delete a group if there are no users belonging to this group.
# Default: ONLY_IF_EMPTY = 0
#ONLY_IF_EMPTY = 0

# Single regular expression which describes filesystems types which should
# be excluded when looking for files of a user to be deleted.
# Default: EXCLUDE_FSTYPES = "(proc|sysfs|usbfs|devpts|tmpfs|afs)"
#EXCLUDE_FSTYPES = "(proc|sysfs|usbfs|devpts|tmpfs|afs)"
```


## 3. Update / Set User's Password:

To update or set user's password:

```bash
sudo passwd <username>

# enter and retye password
```

## Update user's detail:

- Use ``usermod`` with options ``man usermod``

**Syntax:**

```bash
sudo usermod -u <user_id> -g <group_id> -d <user_home_directory> -s <user_shell>
```

**Use above flags:**

- `-u` to provide `user_id`

- `-g` to provide  `group_id`, check group id at: `/etc/group`

- `-d` to provide user home directory.

- `-s` to specify shell, shell options: any one of ``cat /etc/shells``

- `-m` is to create a directory if it doesnt exists.

> Use ``chfn`` to update user's detail.

```bash
> chfn <username>
Changing the user information for <username>
Enter the new value, or press ENTER for the default
        Full Name: <username>
        Room Number []: 98
        Work Phone []: 2123
        Home Phone []: 123123
```

```bash
# list of available shells
>  cat /etc/shells 
# /bin/sh
# /usr/bin/sh
# /bin/bash
# /usr/bin/bash
# /bin/rbash
# /usr/bin/rbash
# /usr/bin/dash

# changing user shell
> sudo usermod -s /bin/rbash <username>

# change current user
> sudo su <username>

# view current user shell
> echo $SHELL
# Output: /bin/rbash 
```

**To change userid**

```bash
usermod  -u new_id username
```

**To change groupid**

```bash
usermod  -g new_id username
```

**To change user home directory:**

```bash
# create a new user
> sudo useradd -s /bin/bash learner

# set user password
> sudo passwd learner

# switch to user
> su learner

> echo $HOME
"/home/learner"

> cd $HOME
# gives error

# Thus the user directory is not created
```

**Creating user directory**

```bash
# create a directory
sudo mkdir -p /home/learner

# chowner for the cirectory
sudo chown learner:learner learner/

# allow: 700 to allow owner only to have rwx
sudo chmod 700 learner/

```

> **Note: Use approproate flag to update. or use ``man usermod`` for more details.**
